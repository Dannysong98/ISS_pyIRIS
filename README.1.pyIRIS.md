# ISS_pyIRIS
###### Information Refining for *In situ* Sequencing
###### (Python3 version)

---

## Introduction

This software is used to transform the fluorescent signal of *In Situ* Sequencing (ISS) into base sequences (barcode 
sequences), as well as the quality of base and their coordinates. 

---

## Installation
### Development environments that passed our test

* macOS 10.14.x
* CentOS 6.x and 7.x
* Ubuntu 16.04.x and 18.04.x
* Python3 3.7.x

We didn't test our software on Microsoft Windows platform.

### Installing Python3 models

We suggest to invoke pip3 to install Python3 models, like:

	pip3 install numpy
	pip3 install scipy
	pip3 install opencv-python==3.4.x
	          or opencv-contrib-python==3.4.x
	
Our software don't restrict the version of numpy and scipy, but we restrict the version of opencv-python or 
opencv-contrib-python to version 3.4.x

---

## Compatible data type

We prepared 2 types of strategies to parse the different techniques of *in situ* sequencing, which are generated by 
methods published by Rongqin Ke and Chee-Huat Linus Eng.

Here, Ke's data (R Ke, Nat. Methods, 2013) is the major data type for our software. In this data, the barcode are 
composed of 5 types of pseudo-color, representing the A, T, C, G bases and background. 

In the type of Eng's data, each image is composed of 4 channels, of which, the first 3 channels means blobs with 
distinction by 3 pseudo-colors and the last one means background. Then, each continuous 4 images are made a Round, also 
named a Cycle. So, there are 12 pseudo-colors in a Round/Cycle. For example, the Eng's data 
(CH Eng, Nat. Methods, 2017) include 5 Rounds, 20 images, 80 channels.

### Directory structure form of data
#### Directory structure form of R Ke

Directory construction form of R Ke we required is:

	data directory
	|---cycle 1
	|   |---Y5.tif
	|   |---FAM.tif
	|   |---TXR.tif
	|   |---Y3.tif
	|   |---DAPI.tif
	|
	|---cycle 2
	|   |---Y5.tif
    |   |---FAM.tif
	|   |---TXR.tif
	|   |---Y3.tif
	|   |---DAPI.tif
	|
	|---cycle 3
	|   |---(...)
	|
	|---cycle 4
	|   |---(...)
	|
	(...)

#### Directory structure form of CH Eng

Directory structure form of CH Eng we recommended is:

	data directory
	|---hyb1
	|   |---pos1.tif
	|   |---pos2.tif
	|   |---pos3.tif
	|   |---(...)
	|
	|---hyb2
	|   |---pos1.tif
	|   |---pos2.tif
	|   |---pos3.tif
	|   |---(...)
	|
	|---hyb3
	|   |---pos1.tif
	|   |---pos2.tif
	|   |---pos3.tif
	|   |---(...)
	|
	|---hyb4
	|   |---pos1.tif
	|   |---pos2.tif
	|   |---pos3.tif
	|   |---(...)
	|
	|---hyb5
	|   |---(...)
	|
	|---hyb6
	|   |---(...)
	|
	|---hyb7
	|   |---(...)
	|
	|---hyb8
	|   |---(...)
	|
	(...)

---

## Usage

You should input the directories of cycle, like one of the following command if your data is consistent with **Ke's**:

	python3 pyIRIS.py --ke 1 2 3 4
	python3 pyIRIS.py --ke {1..4}

You should input the the image files in each cycle, like one of the following command if your data is consistent with 
**Eng's**:

	python3 pyIRIS.py --eng 1/pos1.tif 2/pos1.tif 3/pos1.tif 4/pos1.tif
	python3 pyIRIS.py --eng 1/pos2.tif 2/pos2.tif 3/pos2.tif 4/pos2.tif
	python3 pyIRIS.py --eng {1..20}/pos1.tif
	
---

## Result
### Output of pyIRIS

There will be two output generated in the directory you run the command: the base calling result and the background 
image file. These two file would be used for following analysis of mating visualization script, 'DAIBC'.

    present directory
    |---basecalling_data.txt
    |---background.tif
    
### The format of 'basecalling_data.txt'

The format of 'basecalling_data.txt' contains five columns. Each column means 'ID', 'Barcode sequence', 'Quality of 
sequence', 'Coordinate of row', 'Coordinate of column', respectively.

    r00566c00969    AGGC    III4    00566    00969
    r00648c00397    NAAN    !!#!    00648    00397
    r00432c00243    NANN    !-!!    00432    00243
    r00484c00604    AAGC    ;E('    00484    00604
    r00290c01129    NNGG    !!!"    00290    01129
    r00724c00318    AAGC    =I3.    00724    00318
    r00243c01107    AGGC    IIE'    00243    01107
    r00777c00587    AAGC    IIB7    00777    00587
    r00198c01151    AGGC    =2++    00198    01151
    r00746c00342    AAGC    III>    00746    00342

Here, the values of 4th & 5th fields have been transformed to be consistent with the coordinates of pixels of 
'background.tif'.

---

## ChangeLog
### ChangeLog before releasing

* 2019-01-15 r001 First development version

* 2019-03-18 r002 Make Simple Blob Detector as the default detector

* 2019-03-27 r003 To modify the detecting strategy

* 2019-04-08 r004 To modify the quality algorithm

* 2019-04-09 r005 To adjust the strategy of function of blob exposing

* 2019-04-10 r006 To add the code document to explain primary functions

* 2019-04-16 r007
  1. To modify the algorithm of registration for getting more true positive blobs                
  2. To modify the algorithm for blob detecting for accuracy
  3. To modify the parameter set of blob detector for accuracy

* 2019-04-24 r008 To modify the algorithm for saturate blob exposing

* 2019-04-25 r009 To modify the strategy for blob richly exposing and detection

* 2019-05-09 r010 To modify the algorithm for blob exposing

* 2019-05-12 r011 To modify the algorithm for blob exposing, twice brighten exposed blobs

* 2019-05-13 r012
  1. To modify the method of channel merging by abandoning the DAPI dying
  2. To brighten exposed blobs

* 2019-05-16 r013 To modify the merging strategy of channels

* 2019-05-17 r014 To modify the strategy for blob richly exposing and detection

* 2019-06-27 r015 Only use channel DAPI as the image for registration

* 2019-07-09 r016 To modify the algorithm for error rate

* 2019-07-12 r017 To modify the algorithm for base cube

* 2019-07-12 r018 To modify the algorithm for blob detection

* 2019-08-08 r019 New development version, the prototype version

---

### v1.0 (r019) (2019-08-08)
The first release version.
